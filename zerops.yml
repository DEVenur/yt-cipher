redcipher:
  build:
    base: deno@2
    buildCommands:
      - deno run --allow-read --allow-write ./scripts/patch-ejs.ts
    deployFiles:
      - src
      - scripts
      - server.ts
      - worker.ts
      - deno.jsonc
    cache:
      - .deno_dir
      - deps
  run:
    base: deno@2
    ports:
      - port: 8001
    start: >
      deno run
      --allow-net
      --allow-read
      --allow-env
      server.ts
    env:
      PORT: 8001
      HOST: 0.0.0.0
      MAX_THREADS: 1
      PREPROCESSED_CACHE_SIZE: 150
      API_TOKEN: ${API_TOKEN_ENV_VAR}
